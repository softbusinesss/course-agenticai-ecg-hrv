# Technical Report: ECG-Pomodoro Agentic System

**Author:** 2026-Chen-KunYu  
**Group Members:** Chen Guo-Zhu, Chen Kun-Yu, Liu Yung-Hsin  
**License:** CC-BY-4.0

## Abstract

This report presents an agentic Pomodoro web system that integrates a React frontend timer workflow with two backend microservices: an ECG processing service and an AI advice service. During the WORK phase, the frontend periodically generates and buffers synthetic ECG segments. When the session transitions to REST, the system automatically finalizes the work session by posting a `pomodoro-work/v1` payload to the ECG service to compute session-level metrics (e.g., heart rate and SDNN), then forwards the summary to the AI service to generate user-facing advice.

The AI service optionally calls the Gemini API when `GEMINI_API_KEY` is configured; otherwise it falls back to a deterministic rule-based classifier. The system emphasizes stable data contracts (Pydantic schemas), end-to-end API integration, and repeatable multi-step execution compared with manual chat-only workflows. The final MVP demonstrates a full pipeline (segments → summary → advice) with robust behavior under LLM unavailability.

## Introduction

### Problem context and objectives

Prolonged focus during software development can cause fatigue that reduces code quality. Fatigue-induced tunnel vision often leads to unnecessary variables, inefficient structure, increased memory usage, and higher time complexity. Our stakeholders are software engineers/developers and students in intensive coding courses.

Traditional Pomodoro tools provide time management but lack physiological or context-aware feedback. This project explores an agentic system design where a UI-driven workflow automatically collects physiological signals (synthetic ECG in this implementation), summarizes them into interpretable metrics, and produces actionable advice without requiring the user to manually prompt an AI model or move data across tools.

**Objective:** Build an end-to-end, non-diagnostic awareness pipeline that (1) collects ECG-like segments during focus sessions, (2) summarizes session signals into metrics, and (3) generates structured feedback at session completion.

## System Architecture

The system uses a three-component microservices architecture:

1. **React Frontend (Pomodoro UI)**  
   Controls the Pomodoro state machine, collects ECG segments during WORK, and orchestrates calls to the backend services.

2. **ECG Service (FastAPI)**  
   Accepts session payloads, runs signal preprocessing + peak detection, computes session-level metrics, and returns a `PomodoroSummary`.

3. **AI Service (FastAPI)**  
   Consumes the session summary and generates structured advice. If Gemini is available, it uses LLM generation; otherwise it uses a fallback rule-based classifier.

### End-to-end flow

- During **WORK**, the frontend periodically generates and stores `ecg-seg/v1` segments.
- When entering **REST**, the frontend sends `pomodoro-work/v1` to `/ecg/pomodoro/end`.
- The ECG service returns a session summary.
- The frontend sends the summary to `/ai/pomodoro/advice`.
- The AI service returns advice content for UI display.

This sequence matches the final presentation’s architecture overview and sequence diagram (Run Demo pipeline: segments → summary → advice).

## Implementation

### Frontend (React): Pomodoro state machine and segment buffering

The frontend is implemented as a finite-state machine with states such as `HOME`, `CONFIG`, `WORK`, `PAUSE`, and `REST`. The key behaviors are:

- Periodic ECG segment generation during WORK (demo generator).
- Buffering segments in memory during a work session.
- Automatic session finalization on WORK → REST transition by calling the ECG service, then AI service.

Synthetic ECG segments are generated by `makeDemoEcgSegment()` and serialized as `ecg-seg/v1` with fields including:
- `sampling_rate_hz`
- `channels`
- `samples` shaped as `[N, 1]`

### ECG Service (FastAPI): signal processing and metrics extraction

The ECG service uses FastAPI and Pydantic models (e.g., `EcgSegment`, `EcgFeatures`, `PomodoroSummary`) to enforce stable contracts.

The signal processing pipeline (session-level) includes:
1. Detrending
2. Bandpass filtering
3. Smoothing
4. Derivative-squared moving average approach for peak detection
5. RR-interval estimation
6. Metric computation such as:
   - Heart rate (HR)
   - SDNN (standard deviation of NN intervals)

Operational endpoints include:
- `/ecg/pomodoro/end` (session finalization)
- `/health` (service health check)

The service may also run background threads that update demo status/baseline JSON files.

### AI Service (FastAPI): structured advice with Gemini + fallback

The AI service reads `GEMINI_API_KEY` from environment variables:

- If configured, it calls Gemini via `google.generativeai` and attempts to parse a JSON-structured response.
- If Gemini is not configured, fails, or returns invalid JSON, the service falls back to a deterministic rule-based classifier.

The output schema is represented by a Pydantic model (e.g., `AiPrediction`, schema `ai-pred/v1`) and typically includes:
- a classification label
- key metrics used
- suggestions / concerns for the user

This design choice improves reliability and ensures the pipeline remains functional without external LLM dependency.

## Results

### MVP demonstration

The project achieves an automated end-to-end demo pipeline:

- Users can run a Pomodoro session (WORK/REST) or a short “Run Demo” mode.
- On session completion, the system automatically produces:
  1) a session summary from the ECG service, and  
  2) AI advice from the AI service.

The final presentation includes screenshots of the MVP UI (work/rest timers) and an AI advice output example showing structured fields and computed metrics.

### Robustness under LLM unavailability

A core result is graceful degradation:
- The system still returns advice even if Gemini is not configured, due to rule-based fallback.
- This prevents user-facing failures and keeps the agentic workflow deterministic.

## Discussion

### Challenges

Key challenges encountered include:
- Deploying and configuring an agentic environment with multiple components and workflows.
- Understanding ECG waveform segmentation concepts and rhythm-related feature extraction.
- Designing and compiling slides using LaTeX Beamer.

### Lessons learned

- Precise, structured prompts (and strict output schemas) help guide LLMs toward task-aligned outputs.
- Enforcing stable API contracts reduces integration friction and debugging time.
- Having a deterministic fallback mechanism is essential for reliability in real workflows.

### Limitations

- ECG segments are synthetic in the current implementation, so the physiological validity of “stress vs focus” inference is limited.
- HRV features are minimal and intended for system demonstration rather than medical interpretation.
- LLM outputs can be variable; schema validation and fallback reduce, but do not eliminate, this issue.

## Conclusion

This project demonstrates an end-to-end agentic ECG-Pomodoro system built with a React UI and two FastAPI microservices (ECG processing + AI advice). The key contribution is a repeatable, application-embedded orchestration pipeline that turns session data into interpretable summaries and structured advice without manual prompting or tool switching.

### Future work

- Real hardware integration (replace synthetic ECG with real acquisition).
- User personalization (baseline calibration and trend tracking).
- Expanded HRV feature set and improved signal quality checks.
- Stronger structured-output enforcement for LLM advice generation.

## References

1. Pan, J., & Tompkins, W. J. (1985). *A real-time QRS detection algorithm*. IEEE Transactions on Biomedical Engineering.  
2. FastAPI Documentation. https://fastapi.tiangolo.com/  
3. Task Force of the European Society of Cardiology and the North American Society of Pacing and Electrophysiology. (1996). *Heart rate variability: standards of measurement, physiological interpretation and clinical use*. Circulation, 93(5), 1043–1065.
