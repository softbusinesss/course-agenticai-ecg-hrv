# Technical Report: ECG-Pomodoro

**Author:** 2026-Chen-KunYu  
**Group Members:** Chen GuoZhu, Chen KunYu, Liu YungHsin
**License:** CC-BY-4.0

## Abstract

This report describes an AI-agent-style Pomodoro web application that integrates a frontend timer workflow with two backend microservices: an ECG processing service and an AI advice service. The frontend periodically generates synthetic ECG segments during the work phase, buffers them, and triggers a session finalization when transitioning to rest. At finalization, the system posts a work-session payload to the ECG service to produce a session summary, then forwards the summary to the AI service to generate user-facing advice. The AI service optionally calls Gemini when an API key is configured; otherwise it falls back to a simple rule-based classification. The project emphasizes end-to-end API integration, stable data contracts, and automated multi-step execution compared with manual, chat-only workflows.

## Introduction

Pomodoro workflows provide a simple structure for alternating focused work with short breaks, but users often lack feedback on whether they are actually stressed or focused during a session.  
This project explores an agentic system design where a UI-driven workflow automatically collects physiological signals (synthetic ECG in this implementation), extracts features/summaries, and generates advice through service-to-service communication.

## System Architecture

The system is organized into three components: a React frontend, an ECG FastAPI service, and an AI FastAPI service.  
The frontend is configured to call the ECG service at `http://127.0.0.1:8001` and the AI service at `http://127.0.0.1:8002`, enabling a local end-to-end demo pipeline.

### Data flow

During WORK, the frontend periodically generates and accumulates ECG segments, and when entering REST it sends a `pomodoro-work/v1` session payload to the ECG service endpoint `/ecg/pomodoro/end`.  
After receiving the session summary, the frontend sends it to the AI service endpoint `/ai/pomodoro/advice` to obtain structured advice content for UI display.

## Implementation

### Frontend (React)

A finite-state Pomodoro state machine controls transitions between HOME/CONFIG/WORK/PAUSE/REST and triggers network calls on state transitions.  
Synthetic ECG is generated by `makeDemoEcgSegment()` with configurable sampling rate and segment duration, producing an `ecg-seg/v1` payload that contains `sampling_rate_hz`, `channels`, and 2D `samples` shaped as `[N, 1]`.

### ECG service (FastAPI)

The ECG service uses FastAPI and defines data contracts using Pydantic models, including `EcgSegment`, `EcgFeatures`, and `PomodoroSummary`.  
Its ECG processing pipeline includes detrending, bandpass filtering, smoothing, a derivative-squared moving average approach for peak detection, and the computation of HR and SDNN based on RR intervals.  
The service also provides a `/health` endpoint and background threads that periodically update status/baseline JSON files for demo purposes.

### AI service (FastAPI + optional Gemini)

The AI service reads `GEMINI_API_KEY` from environment variables and configures `google.generativeai` when the key exists.  
It attempts to call Gemini (`MODEL.generate_content`) and parse JSON output into a classification plus suggestions/concerns, and falls back to a rule-based classifier when the API call fails or the response is not valid JSON.  
The API contract for AI outputs is represented by a Pydantic `AiPrediction` model (schema `ai-pred/v1`).

## Results

The project achieves an automated end-to-end demo pipeline where a user can run a Pomodoro session or a short “Run Demo” flow and obtain a session summary plus AI advice without manually copying data between tools.  
The system is robust to missing/failed LLM access due to the built-in rule fallback behavior in the AI service.

## Discussion

A key benefit of the agent approach is that the multi-step workflow (segment collection → summary → advice) is encoded in the application logic and executed consistently via API calls, reducing manual orchestration.  
A main limitation is that ECG segments are currently synthetic in the frontend demo generator, so the physiological validity of “stress vs focus” is not guaranteed and primarily demonstrates architecture and integration.  
Another limitation is that the AI service’s behavior can vary depending on whether Gemini is configured and whether the returned content can be parsed as the expected JSON schema.

## Conclusion

This project demonstrates a microservices-based, agentic workflow for a Pomodoro application that integrates ECG-like signal segments with automated summarization and advice generation.  
Future improvements include integrating real ECG acquisition (instead of synthetic segments), strengthening schema validation between services, and improving reliability of structured LLM outputs.

## References

1. Pan, J., & Tompkins, W. J. (1985). A real-time QRS detection algorithm. IEEE Transactions on Biomedical Engineering.
2. FastAPI Documentation. https://fastapi.tiangolo.com/
