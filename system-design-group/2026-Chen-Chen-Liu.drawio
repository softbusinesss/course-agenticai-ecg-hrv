<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0" version="29.3.2">
  <diagram name="第 1 页" id="rhZiGYzZjxrmyT_V_5EG">
    <mxGraphModel dx="713" dy="394" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=13;fontStyle=1;" value="System Design: ECG-Pomodoro Agent&#xa;Group: 2026-Chen-Chen-Liu | License: CC-BY-4.0" vertex="1">
          <mxGeometry height="40" width="787" x="20" y="10" as="geometry" />
        </mxCell>
        <mxCell id="3" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;" value="Component Diagram (Vertical Layout)" vertex="1">
          <mxGeometry height="25" width="300" x="30" y="60" as="geometry" />
        </mxCell>
        <mxCell id="10" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=6;strokeColor=#000000;fillColor=#ffffff;fontSize=10;" value="&lt;&lt;component&gt;&gt;&#xa;React Frontend (Pomodoro UI)&#xa;&#xa;State machine: HOME/CONFIG/WORK/PAUSE/REST&#xa;Collects segments, calls ECG + AI services" vertex="1">
          <mxGeometry height="100" width="270" x="60" y="100" as="geometry" />
        </mxCell>
        <mxCell id="11" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=6;strokeColor=#000000;fillColor=#ffffff;fontSize=10;" value="&lt;&lt;database&gt;&gt;&#xa;Browser LocalStorage&#xa;&#xa;pomodoro_settings_v1" vertex="1">
          <mxGeometry height="100" width="190" x="460" y="100" as="geometry" />
        </mxCell>
        <mxCell id="12" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=6;strokeColor=#000000;fillColor=#ffffff;fontSize=10;" value="&lt;&lt;component&gt;&gt;&#xa;ECG Service (FastAPI)&#xa;&#xa;GET /health&#xa;POST /ecg/pomodoro/end&#xa;POST /ecg/features" vertex="1">
          <mxGeometry height="100" width="270" x="60" y="240" as="geometry" />
        </mxCell>
        <mxCell id="13" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=6;strokeColor=#000000;fillColor=#ffffff;fontSize=10;" value="&lt;&lt;database&gt;&gt;&#xa;ECG Local Files (data/)&#xa;&#xa;bio_status.json&#xa;user_baseline.json&#xa;summary.json + plots" vertex="1">
          <mxGeometry height="100" width="190" x="460" y="240" as="geometry" />
        </mxCell>
        <mxCell id="14" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=6;strokeColor=#000000;fillColor=#ffffff;fontSize=10;" value="&lt;&lt;component&gt;&gt;&#xa;AI Service (FastAPI)&#xa;&#xa;GET /health&#xa;POST /ai/predict&#xa;POST /ai/pomodoro/advice (frontend)" vertex="1">
          <mxGeometry height="100" width="270" x="60" y="380" as="geometry" />
        </mxCell>
        <mxCell id="15" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=6;strokeColor=#000000;fillColor=#ffffff;fontSize=10;" value="&lt;&lt;external service&gt;&gt;&#xa;Gemini API (optional)&#xa;&#xa;If GEMINI_API_KEY set&#xa;Else: rule_fallback" vertex="1">
          <mxGeometry height="100" width="190" x="460" y="380" as="geometry" />
        </mxCell>
        <mxCell id="20" edge="1" parent="1" source="10" style="endArrow=block;endFill=1;html=1;strokeColor=#000000;" target="11" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="21" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="read/write settings" vertex="1">
          <mxGeometry height="20" width="110" x="340" y="125" as="geometry" />
        </mxCell>
        <mxCell id="22" edge="1" parent="1" source="10" style="endArrow=block;endFill=1;html=1;strokeColor=#000000;" target="12" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="150" y="215" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="23" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="POST /ecg/pomodoro/end&#xa;pomodoro-work/v1&#xa;(segments: ecg-seg/v1[])" vertex="1">
          <mxGeometry height="35" width="130" x="25" y="205" as="geometry" />
        </mxCell>
        <mxCell id="24" edge="1" parent="1" source="12" style="endArrow=block;endFill=0;html=1;strokeColor=#000000;dashed=1;" target="10" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="215" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="25" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="return&#xa;PomodoroSummary" vertex="1">
          <mxGeometry height="25" width="90" x="260" y="205" as="geometry" />
        </mxCell>
        <mxCell id="26" edge="1" parent="1" source="12" style="endArrow=block;endFill=1;html=1;strokeColor=#000000;" target="13" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="27" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="write summaries/plots" vertex="1">
          <mxGeometry height="20" width="110" x="340" y="265" as="geometry" />
        </mxCell>
        <mxCell id="28" edge="1" parent="1" source="10" style="endArrow=block;endFill=1;html=1;strokeColor=#000000;" target="14" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="120" y="355" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="29" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="POST /ai/pomodoro/advice&#xa;(send PomodoroSummary)" vertex="1">
          <mxGeometry height="30" width="110" x="15" y="345" as="geometry" />
        </mxCell>
        <mxCell id="30" edge="1" parent="1" source="14" style="endArrow=block;endFill=0;html=1;strokeColor=#000000;dashed=1;" target="10" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="270" y="355" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="31" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="return advice JSON" vertex="1">
          <mxGeometry height="20" width="90" x="260" y="345" as="geometry" />
        </mxCell>
        <mxCell id="32" edge="1" parent="1" source="14" style="endArrow=block;endFill=1;html=1;strokeColor=#000000;dashed=1;" target="15" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="33" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=9;" value="LLM call (optional)" vertex="1">
          <mxGeometry height="20" width="110" x="340" y="405" as="geometry" />
        </mxCell>
        <mxCell id="40" edge="1" parent="1" style="line;strokeColor=#999999;strokeWidth=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="20" y="510" as="sourcePoint" />
            <mxPoint x="807" y="510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="41" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;" value="Sequence Diagram: Run Demo (3 segments → summary → advice)" vertex="1">
          <mxGeometry height="25" width="500" x="30" y="520" as="geometry" />
        </mxCell>
        <mxCell id="50" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;strokeColor=#000000;fillColor=#ffffff;fontSize=10;fontStyle=1;" value="User" vertex="1">
          <mxGeometry height="35" width="100" x="40" y="560" as="geometry" />
        </mxCell>
        <mxCell id="51" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;strokeColor=#000000;fillColor=#ffffff;fontSize=10;fontStyle=1;" value="React Frontend" vertex="1">
          <mxGeometry height="35" width="120" x="170" y="560" as="geometry" />
        </mxCell>
        <mxCell id="52" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;strokeColor=#000000;fillColor=#ffffff;fontSize=10;fontStyle=1;" value="ECG Service" vertex="1">
          <mxGeometry height="35" width="120" x="320" y="560" as="geometry" />
        </mxCell>
        <mxCell id="53" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;strokeColor=#000000;fillColor=#ffffff;fontSize=10;fontStyle=1;" value="AI Service" vertex="1">
          <mxGeometry height="35" width="120" x="470" y="560" as="geometry" />
        </mxCell>
        <mxCell id="54" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;strokeColor=#000000;fillColor=#ffffff;fontSize=10;fontStyle=1;" value="Gemini (opt)" vertex="1">
          <mxGeometry height="35" width="100" x="620" y="560" as="geometry" />
        </mxCell>
        <mxCell id="60" edge="1" parent="1" style="endArrow=none;html=1;dashed=1;strokeColor=#000000;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="90" y="595" as="sourcePoint" />
            <mxPoint x="90" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="61" edge="1" parent="1" style="endArrow=none;html=1;dashed=1;strokeColor=#000000;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="230" y="595" as="sourcePoint" />
            <mxPoint x="230" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="62" edge="1" parent="1" style="endArrow=none;html=1;dashed=1;strokeColor=#000000;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="595" as="sourcePoint" />
            <mxPoint x="380" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="63" edge="1" parent="1" style="endArrow=none;html=1;dashed=1;strokeColor=#000000;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="595" as="sourcePoint" />
            <mxPoint x="530" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="64" edge="1" parent="1" style="endArrow=none;html=1;dashed=1;strokeColor=#000000;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="670" y="595" as="sourcePoint" />
            <mxPoint x="670" y="950" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="70" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;fontSize=9;" value="1: Click &quot;Run Demo&quot;">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="90" y="630" as="sourcePoint" />
            <mxPoint x="230" y="630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="71" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;fontSize=9;" value="2: generate 3 segments&#xa;(makeDemoEcgSegment)">
          <mxGeometry relative="1" x="-0.0667" y="20" as="geometry">
            <mxPoint as="offset" />
            <mxPoint x="230" y="670" as="sourcePoint" />
            <mxPoint x="380" y="670" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="72" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;dashed=1;fontSize=9;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="685" as="sourcePoint" />
            <mxPoint x="230" y="685" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="73" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;fontSize=9;" value="3: POST /ecg/pomodoro/end">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="230" y="720" as="sourcePoint" />
            <mxPoint x="380" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="74" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;fontSize=9;" value="4: process ECG&#xa;+ create summary">
          <mxGeometry relative="1" x="-0.0667" y="20" as="geometry">
            <mxPoint as="offset" />
            <mxPoint x="380" y="760" as="sourcePoint" />
            <mxPoint x="530" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="75" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;dashed=1;fontSize=9;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="775" as="sourcePoint" />
            <mxPoint x="380" y="775" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="76" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;dashed=1;fontSize=9;" value="5: return PomodoroSummary">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="805" as="sourcePoint" />
            <mxPoint x="230" y="805" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="77" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;fontSize=9;" value="6: POST /ai/pomodoro/advice">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="230" y="840" as="sourcePoint" />
            <mxPoint x="530" y="840" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="78" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;dashed=1;fontSize=9;" value="7: opt LLM call">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="875" as="sourcePoint" />
            <mxPoint x="670" y="875" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="79" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;dashed=1;fontSize=9;" value="8: response">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="670" y="900" as="sourcePoint" />
            <mxPoint x="530" y="900" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="80" edge="1" parent="1" style="endArrow=block;html=1;strokeColor=#000000;dashed=1;fontSize=9;" value="9: return advice JSON">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="935" as="sourcePoint" />
            <mxPoint x="230" y="935" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="90" parent="1" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacing=4;strokeColor=#666666;fillColor=#f5f5f5;fontSize=9;" value="Note: Dashed arrows = synchronous return. AI service falls back to rule-based output if Gemini unavailable." vertex="1">
          <mxGeometry height="30" width="720" x="30" y="960" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
